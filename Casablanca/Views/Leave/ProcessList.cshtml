@using Casablanca.Models
@using Casablanca.Models.Leaves
@using Casablanca.Models.Database
@using Casablanca.Models
@using Casablanca.Models.ExpenseReports

@{
	ViewBag.Title = "Traiter les congés";
	Dal dal = new Dal();
	Collaborator coll = dal.GetCollaborator(User.Identity.Name);
}

@model  List<Leave>

<div class="row">

	<div class="col-sm-4">
		<h2 style="text-align:center;">Calendrier des congés actuels</h2>
		<div id="calendar"></div>
	</div>


	<div class="col-sm-8">

		<h2 class="text-left">Congés à traiter</h2>

		<div class="table-responsive">
			<table id="table"
				   class="table"
				   data-toggle="table"
				   data-search="true">
				@if (Model.Count() == 0)
				{
					<tr>
						<td colspan="10">Aucun congé trouvée.</td>
					</tr>
				}
				else
				{
					<thead>
						<tr>
							<th scope="col" data-field="collaborateur" data-sortable="true">Collaborateur</th>
							<th scope="col" data-field="desc" data-sortable="true">Description</th>
							<th scope="col" data-field="type" data-sortable="true">Type</th>
							<th scope="col" data-field="debut" data-sortable="true">Date de début</th>
							<th scope="col" data-field="fin" data-sortable="true">Date de fin</th>
							<th scope="col" data-field="statut" data-sortable="true">Statut</th>
							<th>Traitement</th>
						</tr>
					</thead>
					<tbody>
						@foreach (Leave item in Model)
						{
							<tr>
								<td>@item.Collaborator.FirstName @item.Collaborator.LastName</td>
								<td>
									@item.Description
								</td>
								<td>
									@HelperModel.ToString(item.Type)
								</td>
								<td>
									@item.StartDate.ToString("dd-MM-yyyy")
								</td>
								<td>
									@item.EndDate.ToString("dd-MM-yyyy")

								</td>

								<td>
									@HelperModel.ToString(item.Status, item.Treatment)
								</td>

								<!--traiter-->
								<td>

									@if (item.Treatment == Processing.HR | item.Treatment == Processing.DHR | item.Treatment == Processing.CEO)
									{
										<div>

											@Html.ActionLink("Valider spécialement", "AcceptLeaveDHR", "Leave", new { id = item.Id }, null) | @Html.ActionLink("Refuser", "RefuseLeaveDHR", "Leave", new { id = item.Id }, null)
										</div>
									}
									
									else if (item.Treatment == Processing.CLASSIC)
									{
										if (item.Status == LeaveStatus.PENDING_APPROVAL_1 | item.Status == LeaveStatus.PENDING_APPROVAL_2)
										{

											<div>
												@Html.ActionLink("Valider", "AcceptLeave", "Leave", new { id = item.Id }, null) | @Html.ActionLink("Refuser", "RefuseLeave", "Leave", new { id = item.Id }, null)
											</div>


										}
									}


								</td>
							</tr>
						}
					</tbody>
				}
			</table>
		</div>


	</div>

</div>




@section Scripts {
	<!-- Bootstrap table -->
	<script src="/Scripts/bootstrap-table.js"></script>

}



